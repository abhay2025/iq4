<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title of IQ -->
    <title>
        IQ Classes
    </title>


    <link rel="shortcut icon" href="img/568.png" type="image/x-icon" />

    <!-- 
    BOOTSTRAP CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">


    <!-- FONT AWESOME -->
    <script src="https://kit.fontawesome.com/c123228cd1.js" crossorigin="anonymous"></script>

    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kurale&family=Monoton&display=swap" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400&family=Merriweather+Sans&family=Ubuntu:wght@300&display=swap"
        rel="stylesheet">


    <!-- CSS File -->
    <link rel="stylesheet" href="common/new.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@500&display=swap');

        .container {
            padding: 2rem 0rem;
        }

        .readmore {
            cursor: pointer;
        }

        .approve {
            margin: auto;
            background-color: red;
            border-radius: 20px;
            padding: 8px 20px;
            color: white;
            position: absolute;
            bottom: 17px;
            margin-left: 14em;
        }

        .approve:hover {
            color: white;
        }

        #more {
            display: none;
        }

        @media only screen and (max-width: 760px) {
            .commentinfo {
                width: 81% !important;
            }

            .approve {
                margin-left: 12em;
            }
        }

        @media (min-width: 576px) {
            .modal-dialog {
                max-width: 467px;
            }

            .modal-dialog .modal-content {
                padding: 1rem;
            }
        }

        .modal-header .close {
            margin-top: -1.5rem;
        }

        .form-title {
            margin: -2rem 0rem 2rem;
        }

        .btn-round {
            border-radius: 3rem;
        }

        .delimiter {
            padding: 1rem;
        }

        .social-buttons .btn {
            margin: 0 0.5rem 1rem;
        }

        .signup-section {
            padding: 0.3rem 0rem;
        }

        .modal {
            background: #000000fb !important;
        }

        .commentinfo {
            background: #ffabb840;
            width: 29%;
            border-radius: 29px;
            margin: auto;
            height: 16em;
            box-shadow: 5px 5px 5px #787878;
            position: relative;
        }

        .commentinfo p,
        #more {
            color: rgb(90, 90, 90);
            text-align: justify;
            font-family: 'Merriweather Sans', sans-serif;
            font-size: 1em;
            letter-spacing: 1px;
            word-break: break-all;
            /* overflow-wrap: break-word; */
        }

        .heading button {
            position: absolute;
            right: 16px;
        }

        .comment-details {
            height: 11em;
            overflow-y: scroll;
        }
    </style>
</head>

<body>
    <section class="mt-4 mb-4">
        <div class="heading d-flex justify-content-center mt-2">
            <h1 class="text-center text-danger wish"></h1>
            <button class="btn btn-danger logout">logout</button>
        </div>
        <h2 class="text-center text-dark mt-4">Comments</h2>
        <!-- <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header border-bottom-0">

                    </div>
                    <div class="modal-body">
                        <div class="form-title text-center">
                            <h4 style="font-size:3em">Login</h4>
                        </div>
                        <div class="d-flex flex-column text-center">
                            <form>
                                <div class="form-group">
                                    <input type="text" class="form-control mb-5" id="name" placeholder="Your Name...">
                                </div>
                                <div class="form-group">
                                    <input type="password" class="form-control mb-5" id="password"
                                        placeholder="Your password...">
                                </div>
                                <div class="alert alert-danger d-none" id="validation" role="alert">
                                </div>
                                <button type="button" class="btn btn-info btn-lg btn-round" id="log">Login</button>
                            </form>


                        </div>
                    </div>

                </div>
            </div>
        </div> -->


        <!-- all comments -->
        <section id="comments" class="mb-5 row ">

        </section>

    </section>
    <!-- JQUERY CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>


    <!-- BOOTSTRAP JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        $(window).on('load', function () {
            showcomment()
        });
        function showcomment() {
            $.ajax({
                url: '/showcmmnt',
                method: 'POST',
                success: function (r) {
                    // if (r == 'USER NOT AUTHENTICATED') {
                    //     // $('#loginModal').modal('show');
                    // }
                    // else {
                    let text;
                    let data = eval(r)
                    for (i in data) {

                        for (let j = 0; j < data[i].comments.length; j++) {
                            // console.log(data[i].comments[j].ref);
                            let approvedat = data[i].comments[j].approved
                            if (approvedat != 'true') {

                                // Readmore
                                if ((data[i].comments[j].text.length) > 60) {
                                    text = `<div class="text ">
                    <span><b>Text=</b></span>
                    <p class="d-inline readmore">${(data[i].comments[j].text).substr(0, 60)}</p><span id="dots">.....</span><span id="more">${(data[i].comments[j].text).substr(60, (data[i].comments[j].text.length))}</span><a class="text-danger readmore ms-2">Read More</a>
                        </div>`}

                                else {
                                    text = `<div class="text ">
                    <span><b>Text=</b></span>
                    <p class="d-inline readmore">${data[i].comments[j].text}</p>
                </div>`
                                }

                                let dat = `<div class="commentinfo py-3 px-4 mt-5 col-lg-4">
                                    <div class="comment-details">
                                <div class="id d-none">
                    <span><b>id=</b></span>
                    <p class="d-inline ">${data[i]._id}</p>
                </div>    
                            <div class="commentid d-none">
                    <span><b>commentid=</b></span>
                    <p class="d-inline ">${data[i].comments[j]._id}</p>
                </div> `+ text +
                                    `<div class="ref mt-4">
                    <span><b>Ref=</b></span>
                    <p class="d-inline">${data[i].comments[j].ref}</p>
                </div>
                <div class="phone mt-4">
                    <span><b>Approve=</b></span>
                    <p class="d-inline">${data[i].comments[j].approved}</p>
                </div>
                <button class="btn  mt-4 approve">Approve</button>
                </div>
            </div>`

                                $('#comments').append(dat);
                            }
                        }
                    }
                    // }
                }

            })
        }
        function contactres() {
            $('#name').val("")
            $('#password').val("")
            $('#validation').addClass('d-none')
        }
        function alermessage(str) {
            $('#validation').text(str);
            $('#validation').removeClass('d-none')
        }


        $('#log').click(() => {
            let name = $('#name').val()
            let password = $('#password').val()

            if (name == "" && password == "") {
                alermessage("Please Fill properly")
            }
            else if (name == "") {
                alermessage("Please fill the name properly")
            }
            else if (password == "") {
                alermessage("Please fill the password properly")
            }
            else {
                $.ajax({
                    url: '/checkstaff',
                    method: 'POST',
                    data: {
                        name,
                        password
                    },
                    success: function (r) {
                        console.log(r);
                        if (r == 'notuser') {
                            alermessage("Please enter correct name and password")
                        }
                        else {
                            contactres()
                            $('#loginModal').modal('hide');
                            showcomment()
                        }
                    }
                })


            }
        })


    </script>
    <!-- <script>
        $('.logout').click(() => {
            $.ajax({
                url: '/logout',
                method: 'POST',
                success: function (r) {
                    $('#comments').empty()
                    $('#loginModal').modal('show');
                }
            })
        })
    </script> -->
    <!-- for approval -->
    <script>
        $('body').on("click", ".approve", function () {
            let id = this.parentElement.firstElementChild.children[1].innerText
            let commentid = this.parentElement.children[1].children[1].innerText
            // console.log(id);
            // console.log(commentid);
            $('#comment').remove()
            $.ajax({
                url: '/approve',
                method: 'POST',
                data: {
                    id,
                    commentid
                },
                success: function (r) {
                    $('#comments').empty()
                    showcomment()
                }
            })
        })
    </script>

    <!-- Read more -->

    <script>
        $(document).on("click", ".readmore", function () {
            let dots = this.parentNode.children[2]
            let more = this.parentNode.children[3]
            console.log(more);
            let button = this
            if (dots.style.display === "none") {
                dots.style.display = "inline";
                button.innerHTML = "Read more";
                more.style.display = "none";
            } else {
                dots.style.display = "none";
                button.innerHTML = "Read less";
                more.style.display = "inline";
            }
        })
    </script>

    <!-- For wish -->
    <script>
        let day = new Date();
        let hr = day.getHours();
        if (hr >= 0 && hr < 12) {
            $('.wish').text('Good Morning Abhay')
        }
        else if (hr == 12) {
            $('.wish').text('Good Noon Abhay')
        }
        else if (hr >= 12 && hr <= 17) {
            $('.wish').text('Good Afternoon Abhay')
        }
        else {
            $('.wish').text('Good Evening Abhay')
        }
    </script>
</body>

</html>